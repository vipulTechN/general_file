<form>
<div id="image-fields-container">
        <!-- Render formset forms -->
        {{ property_image_formset.management_form }}
        {% for form in property_image_formset %}
            <div class="image-field">
                {{ form.as_p }}
            </div>
        {% endfor %}
    </div>
    
    <button type="button" id="add-image-field">Add Image</button>
</form>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $(document).ready(function() {
        const container = $('#image-fields-container');
        const maxForms = 5; // Maximum total forms allowed

        // Hide forms beyond the second one initially
        container.find('.image-field:gt(1)').hide();

        $('#add-image-field').click(function() {
            const formCount = container.find('.image-field:visible').length;

            if (formCount < maxForms) { // Limit to maximum total forms
                const totalForms = $('#id_propertyimage_set-TOTAL_FORMS');
                const newForm = container.find('.image-field:hidden:first').clone(true);

                // Update form IDs, names, and reset input values
                const formIndex = formCount; // Start indexing from formCount
                newForm.find('input[type="file"]').attr({
                    'id': `id_images-${formIndex}-image`,
                    'name': `images-${formIndex}-image`
                }).val('');
                newForm.find('select').attr({
                    'id': `id_images-${formIndex}-image_type`,
                    'name': `images-${formIndex}-image_type`
                }).val(newForm.find('select option:first').val());
                newForm.find('input[type="checkbox"]').attr({
                    'id': `id_images-${formIndex}-DELETE`,
                    'name': `images-${formIndex}-DELETE`
                }).prop('checked', false);
                newForm.find('input[type="hidden"]').attr('id', `id_images-${formIndex}-id`).val('');
                newForm.find('input[type="hidden"]').attr('id', `id_images-${formIndex}-property_post`).val('');

                // Append new form and update total forms count
                container.append(newForm);
                totalForms.val(formCount + 1);

                newForm.show(); // Show the newly added form

                if (formCount + 1 === maxForms) {
                    $('#add-image-field').hide();
                }
            } else {
                alert('You can upload a maximum of 5 images.');
            }
        });
    });
</script>